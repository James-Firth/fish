<html>
<head>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script language="JavaScript">
        function getValue(varname) {
            var url = window.location.href;
            var qparts = url.split("?");
            if (qparts.length == 0) {
                return "";
            }
            var query = qparts[1];
            var vars = query.split("&");
            var value = "";
            for (i = 0; i < vars.length; i++) {
                var parts = vars[i].split("=");
                if (parts[0] == varname) {
                    value = parts[1];
                    break;
                }
            }
            value = unescape(value);
            value.replace(/\+/g," ");
            return value;
        }

        var user = getValue("uid");
        var runningSims;
        var archivedSims;
        console.log("User: " + user);


        var socket = io.connect();

        socket.on("connect", function (data) {
            console.log("Connected to server.");
        });

        socket.on("running simulations list", function (data) {
            $("#loadingInProgress").empty();
            runningSims = data;
            $("#inProgressList").empty();
            var item;
            for (item in data) {
                $("#inProgressList").append("<li><b>" + data[item].name +
                        "</b>, with " + data[item].numOceans + " oceans (" +
                        data[item].remainingOceans + " still available).</li>");
            }
        });

        socket.on("archived simulations list", function (data) {
            $("#loadingArchived").empty();
            archivedSims = data;
            $("#archivedList").empty();
            var item;
            for (item in data) {
                formattedItem = "<li><a href='archivedFile?" + user + "/" + data[item].name + "'>" + data[item].name + "</a></li>"
                $("#archivedList").append(formattedItem);
            }
        });

        var loadRunningOceanGroups = function (user) {
            $("#loadingInProgress").append("<em>(loading...)</em>");
            socket.emit("get running simulations", user);
        }

        var loadArchivedOceanGroups = function (user) {
            $("#loadingArchived").append("<em>(loading...)</em>");
            socket.emit("get archived simulations", user);
        }

        var Main = function() {
            loadRunningOceanGroups(user);
            loadArchivedOceanGroups(user);
        }

        $(document).ready(Main);

    </script>
    <title>Admin - Main Screen</title>
</head>

<body>
<h2>Fish Administration</h2>

<h3>Create a new group</h3>

Click this button to go to the New Group page:
<br>
<form>
    <button type="button" onclick="location.href='newgroup?uid=' + user">Create a simulation</button>
</form>

<h3>Simulations in Progress</h3>
<div id="simsInProgress">
    <label id="loadingInProgress"></label>
    <ul id="inProgressList">

    </ul>
</div>
<br>

<h3>Simulations Completed</h3>
<div id="simsArchived">
    <label id="loadingArchived"></label>
    <ul id="archivedList">

    </ul>
</div>
<br><br>
</body>
</html>
