<html>
<head>
    <style>
        #title {
            text-align: center;
            font-size: 20pt;
        }

        legend {
            text-align: center;
            font-size: 16pt;
        }

        h2 {
            text-align: left;
            font-size: 14pt;
        }

        .left-side-label {
            width: 12em;
            float: left;
            text-align: right;
            margin-right: 0.5em;
            display: block;
        }

        .status-message {
            font-size: 10pt;
        }

        .blue {
            color: blue;
        }

        .red {
            color: red;
        }

        .hidden {
            visibility: hidden;
        }

        .radio-button-label {
            cursor: pointer;
        }

        fieldset {
            border: 0px solid #dadada;
            width: 24em;
        }

        fieldset.floating {
            float: left;
        }

        div.break {
            clear: both;
            margin-bottom: 3px;
        }


    </style>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" language="JavaScript">
        function getValue(varname) {
            var url = window.location.href;
            var qparts = url.split("?");
            if (qparts.length == 0) {
                return "";
            }
            var query = qparts[1];
            var vars = query.split("&");
            var value = "";
            for (i = 0; i < vars.length; i++) {
                var parts = vars[i].split("=");
                if (parts[0] == varname) {
                    value = parts[1];
                    break;
                }
            }
            value = unescape(value);
            value.replace(/\+/g," ");
            return value;
        }

        var user = getValue("uid");
        console.log("User: " + user);

        var socket = io.connect();

        socket.on("connect", function (data) {
            console.log("Connected to server.");
        });

        socket.on("group-created", function() {
            // Go back to mainadmin window
            location.href = "mainadmin?uid=" + user;
        });

        socket.on("group-not-created", function() {
            $("#create").prop("disabled", false);
            $(".status-message").toggleClass("red");
            $(".status-message").text("The simulation '" + $("#gid").val() + "' could not be created. That name may already be in use; please use a different one.");
        });

        function Robot(name, greed) {
            this.name = name;
            this.greed = greed;
        }

        function gameParameters() {
            // Getting all the parameters from the page's fields
            this.owner = user;
            this.name = $("#gid").val();
            this.numFishers = parseInt($("#numfishers").val());
            this.numHumans = parseInt($("#numhumans").val());
            this.numOceans = parseInt($("#numoceans").val());
            this.numSeasons = parseInt($("#seasons").val());
            this.initialDelay = parseInt($("#initialdelay").val());
            this.restDuration = parseInt($("#seasondelay").val());
            this.spawnFactor = parseFloat($("#spawnfactor").val());
            this.chanceOfCatch = parseFloat($("#chancecatch").val());
            this.costDepart = parseInt($("#costdeparture").val());
            this.costAtSea = parseInt($("#costsecond").val());
            this.costCast = parseInt($("#costcast").val());
            this.valueFish = parseInt($("#fishvalue").val());
            this.seasonDuration = parseInt($("#seasonduration").val());
            this.certainFish = parseInt($("#realfish").val());
            this.actualMysteryFish = parseInt($("#startingmysteryfish").val());
            this.mysteryFish = parseInt($("#mysteryfish").val());
            this.showOtherFishers = $("#showallfishers-yes").prop("checked");
            this.showFisherNames = $("#shownames-yes").prop("checked");
            this.showFisherStatus = $("#showstatus-yes").prop("checked");
            this.showFishCaught = $("#shownumcaught-yes").prop("checked");
            this.showBalance = $("#showbalance-yes").prop("checked");
            this.pauseEnabled = $("#pauseenabled-yes").prop("checked");

            if ($("#greeduniformity-uniform").prop("checked")) {
                this.greedUniformity = 0;
            } else if ($("#greeduniformity-increasing").prop("checked")) {
                this.greedUniformity = 1;
            } else {
                this.greedUniformity = -1;
            }
            this.erratic = $("#erratic-yes").prop("checked");
            this.hesitation = parseFloat($("#hesitation").val());
            this.castsPerSecond = parseInt($("#castspersecond").val());
            this.castingProbability = parseFloat($("#castingprobability").val());

            this.robots = new Array();
            this.robots[0] = new Robot($("#agent1name").val(), parseFloat($("#agent1greed").val()));
            this.robots[1] = new Robot($("#agent2name").val(), parseFloat($("#agent2greed").val()));
            this.robots[2] = new Robot($("#agent3name").val(), parseFloat($("#agent3greed").val()));

            this.prepText = $("#preptext").val();
            this.depletedText = $("#depletedtext").val();
            this.endText = $("#endtext").val();
        }

        var CreateGroup = function () {
            var gs = new gameParameters();
            $("#create").prop("disabled", true);
            $(".status-message").toggleClass("blue");
            $(".status-message").text("Requesting server to create simulation " + $("#gid").val() + "...");
            console.log("Requesting server to create group " + $("#gid").val());
            socket.emit("create group", gs);
        }

        var ToggleGreed = function() {
            // Enabling and disabling global and particular greed parameters
            var constantGreed = $("#globalgreed-constant").prop("checked");
            $("#globalconstantgreed").prop("disabled", !constantGreed);
            $(".agentgreed").prop("disabled", constantGreed);
            if (constantGreed) {
                $(".agentgreed").val( $("#globalconstantgreed").val() );
            }
        }

        var Main = function() {
            $(".greedtoggler").change(ToggleGreed);
            $("#create").click(CreateGroup);
        }

        $(document).ready(Main);
    </script>

    <title>Settings for a new simulation</title>
</head>

<body>
<div id="title">Settings for a new simulation</div>

<hr/>
<div class="break"></div>

<form name="newgroup">
    <fieldset class="floating">
        <legend>General settings</legend>
        <p>
            <label for="gid" class="left-side-label">Simulation name</label>
            <input type="text" id="gid"/>
        </p>

        <p>
            <label for="numfishers" class="left-side-label">Total fishers per ocean</label>
            <input type="number" min="0" step="1" max="4" id="numfishers" value="4" />
        </p>

        <p>
            <label for="numhumans" class="left-side-label">Human fishers per ocean</label>
            <input type="number" min="0" step="1" max="4" id="numhumans" value="1" />
        </p>

        <p>
            <label for="numoceans" class="left-side-label">Oceans</label>
            <input type="number" min="0" step="1" id="numoceans" value="1"/>
        </p>

        <p>
            <label for="seasons" class="left-side-label">Fishing seasons</label>
            <input type="number" min="0" step="1" id="seasons" value="4" />
        </p>

        <p>
            <label for="seasonduration" class="left-side-label">Season length in seconds</label>
            <input type="number" min="0" step="1" id="seasonduration" value="60" />
        </p>

        <p>
            <label for="initialdelay" class="left-side-label">Initial delay seconds</label>
            <input type="number" min="0" step="1" id="initialdelay" value="10" />
        </p>

        <p>
            <label for="seasondelay" class="left-side-label">Season delay seconds</label>
            <input type="number" min="0" step="1" id="seasondelay" value="10" />
        </p>

        <p>
            <label for="pauseenabled" class="left-side-label">Allow client to pause?</label>
            <input type="radio" name="pauseenabled" id="pauseenabled-yes" value="y" checked/>
            <label for="pauseenabled-yes" class="radio-button-label">Yes</label>
            <br/>
            <label class="left-side-label hidden"> Allow client to pause? </label>
            <input type="radio" name="pauseenabled" id="pauseenabled-no" value="n"/>
            <label for="pauseenabled-no" class="radio-button-label">No</label>
        </p>
    </fieldset>

    <fieldset class="floating">
        <legend>Economics</legend>
        <p>
            <label for="fishvalue" class="left-side-label">Fish value</label>
            <input type="number" min="0" step="1" id="fishvalue" value="3" />
        </p>

        <p>
            <label for="costcast" class="left-side-label">Cost to cast</label>
            <input type="number" min="0" step="1" id="costcast" value="0"/>
        </p>

        <p>
            <label for="costdeparture" class="left-side-label">Cost per departure</label>
            <input type="number" min="0" step="1" id="costdeparture" value="0"/>
        </p>

        <p>
            <label for="costsecond" class="left-side-label">Cost per second at sea</label>
            <input type="number" min="0" step="1" id="costsecond" value="0"/>
        </p>
    </fieldset>

    <fieldset class="floating">
        <legend>Fish stocks and fishing</legend>

        <p>
            <label for="realfish" class="left-side-label">Certain fish</label>
            <input type="number" min="0" step="1" id="realfish" value="40" />
        </p>

        <p>
            <label for="startingmysteryfish" class="left-side-label">Available mystery fish</label>
            <input type="number" min="0" step="1" id="startingmysteryfish" value="0" />
        </p>

        <p>
            <label for="mysteryfish" class="left-side-label">Potential mystery fish</label>
            <input type="number" min="0" step="1" id="mysteryfish" value="0" />
        </p>

        <p>
            <label for="spawnfactor" class="left-side-label">Spawn factor</label>
            <input type="number" min="0" step="0.1" id="spawnfactor" value="2.0" />
        </p>

        <p>
            <label for="chancecatch" class="left-side-label">Chance of catch</label>
            <input type="number" min="0" step="0.01" id="chancecatch" value="1.0" />
        </p>
    </fieldset>

    <div class="break"></div>
    <hr/>
    <div class="break"></div>

    <fieldset class="floating">
        <legend>Information display</legend>

        <p>
            <label for="showallfishers" class="left-side-label">Show all fishers?</label>
            <input type="radio" name="showallfishers" id="showallfishers-yes" value="y" checked/>
            <label for="showallfishers-yes" class="radio-button-label">Yes</label>
            <br/>
            <label class="left-side-label hidden"> Show all fishers? </label>
            <input type="radio" name="showallfishers" id="showallfishers-no" value="n"/>
            <label for="showallfishers-no" class="radio-button-label">No</label>
        </p>

        <p>
            <label for="shownames" class="left-side-label">Show their names?</label>
            <input type="radio" name="shownames" id="shownames-yes" value="y" checked/>
            <label for="shownames-yes" class="radio-button-label">Yes</label>
            <br/>
            <label class="left-side-label hidden"> Show their names? </label>
            <input type="radio" name="shownames" id="shownames-no" value="n"/>
            <label for="shownames-no" class="radio-button-label">No</label>
        </p>

        <p>
            <label for="showstatus" class="left-side-label">Show their status?</label>
            <input type="radio" name="showstatus" id="showstatus-yes" value="y" checked/>
            <label for="showstatus-yes" class="radio-button-label">Yes</label>
            <br/>
            <label class="left-side-label hidden"> Show their status? </label>
            <input type="radio" name="showstatus" id="showstatus-no" value="n"/>
            <label for="showstatus-no" class="radio-button-label">No</label>
        </p>

        <p>
            <label for="shownumcaught" class="left-side-label">Show their number of fish caught?</label>
            <input type="radio" name="shownumcaught" id="shownumcaught-yes" value="y" checked/>
            <label for="shownumcaught-yes" class="radio-button-label">Yes</label>
            <br/>
            <label class="left-side-label hidden"> Show their number of fish caught? </label>
            <input type="radio" name="shownumcaught" id="shownumcaught-no" value="n"/>
            <label for="shownumcaught-no" class="radio-button-label">No</label>
        </p>

        <p>
            <label for="showbalance" class="left-side-label">Show their balance?</label>
            <input type="radio" name="showbalance" id="showbalance-yes" value="y" checked/>
            <label for="showbalance-yes" class="radio-button-label">Yes</label>
            <br/>
            <label class="left-side-label hidden"> Show their balance? </label>
            <input type="radio" name="showbalance" id="showbalance-no" value="n"/>
            <label for="showbalance-no" class="radio-button-label">No</label>
        </p>
    </fieldset>

    <fieldset class="floating">
        <legend>Bot information</legend>

        <p>
            <label for="globalgreed" class="left-side-label">Greediness should...</label>
            <input type="radio" class="greedtoggler" name="globalgreed" id="globalgreed-vary" value="vary" checked />
            <label for="globalgreed-vary" class="radio-button-label">vary between bots</label>
            <br/>
            <label for="globalgreed" class="left-side-label hidden">Greediness should...</label>
            <input type="radio" class="greedtoggler" name="globalgreed" id="globalgreed-constant" value="constant" />
            <label for="globalgreed-constant" class="radio-button-label">be consistent at </label>
            <br/>
            <label class="left-side-label hidden">Constant greed level</label>
            <input type="number" min="0" step="0.01" max="1" class="greedtoggler" name="globalconstantgreed" id="globalconstantgreed" value="0.5" disabled="disabled" />
        </p>

        <p>
            <label for="greeduniformity" class="left-side-label">Greediness should...</label>
            <input type="radio" name="greeduniformity" id="greeduniformity-uniform" value="uniform" checked />
            <label for="greeduniformity-uniform" class="radio-button-label">remain stable</label>
            <br/>
            <label for="greeduniformity" class="left-side-label hidden">Greediness should...</label>
            <input type="radio" name="greeduniformity" id="greeduniformity-increasing" value="increasing" />
            <label for="greeduniformity-increasng" class="radio-button-label">progressively increase</label>
            <br/>
            <label for="greeduniformity" class="left-side-label hidden">Greediness should...</label>
            <input type="radio" name="greeduniformity" id="greeduniformity-decreasing" value="decreasing" />
            <label for="greeduniformity-decreasing" class="radio-button-label">progressively decrease</label>
        </p>

        <p>
            <label for="erratic" class="left-side-label">Should bots be erratic?</label>
            <input type="radio" name="erratic" id="erratic-yes" value="y" checked/>
            <label for="erratic-yes" class="radio-button-label">Yes</label>
            <br/>
            <label class="left-side-label hidden"> Should bots be erratic? </label>
            <input type="radio" name="erratic" id="erratic-no" value="n"/>
            <label for="erratic-no" class="radio-button-label">No</label>
            <br/>
            <em>Note: erratic bots hesitate and cast for fish at different rates.
            This causes them to behave non-optimally.</em>
        </p>

        <p>
            <label for="hesitation" class="left-side-label">Hesitation factor</label>
            <input type="number" min="0.01" step="0.01" id="hesitation" value="0.4" />
        </p>

        <p>
            <label for="castspersecond" class="left-side-label">Maximum casts per second</label>
            <input type="number" min="1" step="1" id="castspersecond" value="3" />
        </p>

        <p>
            <label for="castingprobability" class="left-side-label">Casting probability factor</label>
            <input type="number" min="0.01" step="0.01" id="castingprobability" value="0.8" />
        </p>
    </fieldset>

    <fieldset class="floating">
        <legend>Individual bot details</legend>
        <p>
            <label for="agent1name" class="left-side-label">Bot 1's name</label>
            <input type="text" id="agent1name" value="Kermit"/>
        </p>

        <p>
            <label for="agent1greed" class="left-side-label">Bot 1's greed</label>
            <input type="number" min="0" step="0.01" max="1" id="agent1greed" value="0.5" class="agentgreed" />
        </p>

        <p>
            <label for="agent2name" class="left-side-label">Bot 2's name</label>
            <input type="text" id="agent2name" value="Gonzo"/>
        </p>

        <p>
            <label for="agent2greed" class="left-side-label">Bot 2's greed</label>
            <input type="number" min="0" step="0.01" max="1" id="agent2greed" value="0.5" class="agentgreed" />
        </p>

        <p>
            <label for="agent3name" class="left-side-label">Bot 3's name</label>
            <input type="text" id="agent3name" value="Piggy"/>
        </p>

        <p>
            <label for="agent3greed" class="left-side-label">Bot 3's greed</label>
            <input type="number" min="0" step="0.01" max="1" id="agent3greed" value="0.5" class="agentgreed"/>
        </p>

    </fieldset>

    <div class="break"></div>
    <hr/>
    <div class="break"></div>

    <fieldset class="floating">
        <legend>Preparatory text</legend>
        <textarea id="preptext" rows="35" cols="50">
            FISH simulates fishing in an ocean. You and the other fishers are the only fishers in this ocean. All the fishers see the same ocean that you do. At the beginning, the number of fish will be displayed on the screen. However, sometimes there is some uncertainty about the number of fish. In those cases, 'mystery fish' will be shown on the screen as well, and the number is displayed as a certain range, not as an absolute number. Once the simulation begins, you and the other fishers may catch as many of these fish as you like. Once  you have taken as many fish as you want, you return to port with your catches, and the first season ends. Then the fish spawn for the next season, if any are left to spawn (if no fish are left, they cannot spawn). For every fish left at the end of one season, two fish will be available to be caught in the next season. However, because the ocean can support only so many fish, the total number of fish will never exceed the original number of fish. Fishing can go on this way for many seasons, but all fishing permanently ceases any time that all the fish are caught.

            You can make money fishing. You will be paid $5 for every fish you catch. (For now, this is 'play' money...but please treat it as if it were real money.)

            Your job is to consider all these factors, and the other fishers, and make your own decisions about how to fish. Fish however you wish.

            Please ask if anything is unclear. We want you to fully understand the rules before you start fishing.

            If you are sure you understand all the above, you are ready to fish. Click on the Go Fishing button on the left when you are ready. Once all the fishers have clicked this button, the first season will begin. (You may have to wait briefly for all the others fishers to click the button.)
        </textarea>
    </fieldset>

    <fieldset class="floating">
        <legend>End of simulation message</legend>
        <textarea id="endtext" rows="35" cols="50">
            Seasons come and seasons go, but for now we are done.
        </textarea>
    </fieldset>

    <fieldset class="floating">
        <legend>Depleted fish stock text</legend>
        <textarea id="depletedtext" rows="35" cols="50">
            All the fish are now gone.
        </textarea>
    </fieldset>

    <div class="break"></div>
    <hr/>
    <div class="break"></div>

    <button type="button" id="create">Create this Group</button> <label class="status-message"></label>
</form>

</body>
</html>
