<html>
<head>
<script src="/socket.io/socket.io.js"></script>
<script language="JavaScript">
  var socket = io.connect();
  var gameSettings = null;
  var id = null;
  var agents = null;
  var loop;
  var cCanvas;
  var cContext;
  var oCanvas;
  var oContext;
  var iCanvas;
  var iContext;
  var sailingAllowed = false;
  var fishingAllowed = false;
  var returningAllowed = false;
  var seconds;


  socket.on('gamesettings', function (gs) {
    console.log(gs);
    gameSettings = gs;
  });

  socket.on('myID', function (myID) {
    console.log(myID);
    id = myID;
  });
  
  socket.on('agents', function (ags) {
    console.log(ags);
    agents = ags;
  });
  
  socket.on('news', function (data) {
    console.log(data);
  });
  
  socket.on('begin', function (data) {
  	console.log('begin: ' + data);
  	sailingAllowed = true;
  });
  
  socket.on('time', function (data) {
  	console.log('Seconds from start: ' + data);
  	seconds = data;
  });

  socket.on('pausetime', function (data) {
  	console.log('Seconds from start of pause: ' + data);
  	seconds = data;
  });

  socket.on('endseason', function (data) {
  	console.log('Season ' + data + ' ended.');
  	sailingAllowed = false;
  	fishingAllowed = false;
  	returningAllowed = false;
  });
  
  socket.on('gameover', function (data) {
  	console.log('Simulation over.');
  	sailingAllowed = false;
  	fishingAllowed = false;
  	returningAllowed = false;
  });
  
  socket.on('message',function(data) {
	  console.log('Received a message from the server!', data);
  });
</script>

<title>Client - Main Screen</title>

<script src="getvalue.js"></script>
<script language="JavaScript">

function goToSeaOnClick() {
	socket.emit('toSea', {id: id});
	sailingAllowed = false;
	fishingAllowed = true;
	returningAllowed = true;
}

function returnToPortOnClick() {
	socket.emit('toPort', {id: id});
	sailingAllowed = true;
	fishingAllowed = false;
	returningAllowed = false;
}

function castForFishOnClick() {
	if (gameSettings.certainFish + gameSettings.actualMysteryFish <= 1) {
		fishingAllowed = false;
	}
	socket.emit('fishing', {id: id});
}


function controlOnClick(e) {
	var x;
    var y;
    if (e.pageX != undefined && e.pageY != undefined) {
		x = e.pageX;
		y = e.pageY;
    } else {
		x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
		y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
    }
	x -= cCanvas.offsetLeft;
	y -= cCanvas.offsetTop;

	if ((x >= 20) && (x <= 220) && (y >= 140) && (y <= 170) && sailingAllowed) {
		goToSeaOnClick();
		drawAll();
	}

	if ((x >= 20) && (x <= 220) && (y >= 180) && (y <= 210) && returningAllowed) {
		returnToPortOnClick();
		drawAll();
	}

	if ((x >= 20) && (x <= 220) && (y >= 220) && (y <= 250) && fishingAllowed) {
		castForFishOnClick();
		drawAll();
	}
	
}


function drawControl() {
	cCanvas = document.getElementById("controlCanvas");
	cCanvas.addEventListener("click", controlOnClick, false);
	cContext = cCanvas.getContext("2d");
	cContext.font = "12px sans-serif";
	cContext.fillText("Main simulation screen", 20, 20);
	
	if (gameSettings != null) {
		cContext.fillText("Each fish earns you $" + gameSettings.valueFish, 20, 60);
		cContext.fillText("Casting for a fish costs $" + gameSettings.costCast, 20, 80);
		cContext.fillText("Each minute at sea costs $" + gameSettings.costAtSea, 20, 100);
		cContext.fillText("Leaving port costs $" + gameSettings.costDepart, 20, 120);
		
		if (gameSettings.certainFish + gameSettings.actualMysteryFish < 1) {
			fishingAllowed = false;
		}
		
		if ((gameSettings.status == "running") && (sailingAllowed)) {
			cContext.fillStyle = "orange";
			cContext.fillRect(20, 140, 200, 30);
			cContext.fillStyle = "black";
			cContext.font = "bold 12px sans-serif";
			cContext.fillText("Go out to sea", 30, 160);
		} else {
			cContext.fillStyle = "gainsboro";
			cContext.fillRect(20, 140, 200, 30);
			cContext.fillStyle = "darkslategray";
			cContext.font = "bold 12px sans-serif";
			cContext.fillText("Go out to sea", 30, 160);		
		}
		if ((gameSettings.status == "running") && (returningAllowed)) {
			cContext.fillStyle = "orange";
			cContext.fillRect(20, 180, 200, 30);
			cContext.fillStyle = "black";
			cContext.font = "bold 12px sans-serif";
			cContext.fillText("Return to port", 30, 200);
		} else {
			cContext.fillStyle = "gainsboro";
			cContext.fillRect(20, 180, 200, 30);
			cContext.fillStyle = "darkslategray";
			cContext.font = "bold 12px sans-serif";
			cContext.fillText("Return to port", 30, 200);
		}
		if ((gameSettings.status == "running") && (fishingAllowed)) {
			cContext.fillStyle = "orange";
			cContext.fillRect(20, 220, 200, 30);
			cContext.fillStyle = "black";
			cContext.font = "bold 12px sans-serif";
			cContext.fillText("Cast for one fish", 30, 240);
		} else {
			cContext.fillStyle = "gainsboro";
			cContext.fillRect(20, 220, 200, 30);
			cContext.fillStyle = "darkslategray";
			cContext.font = "bold 12px sans-serif";
			cContext.fillText("Cast for one fish", 30, 240);
		}
	}
}

function clearControl() {
	cCanvas = document.getElementById("controlCanvas");
	cContext = cCanvas.getContext("2d");
	cContext.clearRect(0,0,300,700);
}

function drawOcean() {
	oCanvas = document.getElementById("oceanCanvas");
	oContext = oCanvas.getContext("2d");
	oContext.font = "12px sans-serif";
	if (gameSettings != null) {
		minFish = gameSettings.certainFish
		maxFish = minFish + gameSettings.mysteryFish
		oContext.fillText("This is season " + gameSettings.currentSeason + ". There are between " + minFish + " and " + maxFish + " fish remaining.", 100, 20);
	} else {
		oContext.fillText("Message about Season number and fish remaining.", 100, 20);
	}
	oContext.font = "20px sans-serif";
	oContext.fillText("Fishies go here!", 200, 200);
}

function clearOcean() {
	oCanvas = document.getElementById("oceanCanvas");
	oContext = oCanvas.getContext("2d");
	oContext.clearRect(0,0,800,500);
}

function drawInfo() {
	iCanvas = document.getElementById("infoCanvas");
	iContext = iCanvas.getContext("2d");

	iContext.fillStyle = "pink";
	iContext.fillRect(40, 30, 190, 100);
	iContext.fillRect(240, 30, 140, 100);
	iContext.fillRect(390, 30, 300, 100);
	
	iContext.fillStyle = "black";
	iContext.font = "12px sans-serif";
	if (gameSettings != null) {
		iContext.fillText("Fisher               Fish caught   Money   Status", 50, 50);
		for (i = 0; i < gameSettings.players.length; i++) {
			iContext.fillText(gameSettings.players[i].name + "              " + gameSettings.players[i].fishCaught + "      " + gameSettings.players[i].money + "       " + gameSettings.players[i].status, 50, 70 + (i * 20));
		}
		iContext.fillText(gameSettings.status, 50, 130);
	} else {
		iContext.fillText('booting up', 50, 130);
	}
}

function clearInfo() {
	iCanvas = document.getElementById("infoCanvas");
	iContext = iCanvas.getContext("2d");
	iContext.clearRect(0,0,800,200);
}

function drawAll() {
	clearControl();
	drawControl();
	clearOcean();
	drawOcean();
	clearInfo();
	drawInfo();
	loop = setTimeout('drawAll()', 1000);
}
</script>
</head>


<body onload="drawAll()">

<div width="1210" height="760" style="overflow: auto">
<canvas id="controlCanvas" width="300" height="700" style="float: left"></canvas>

<canvas id="oceanCanvas" width="800" height="500"></canvas>

<canvas id="infoCanvas" width="800" height="200"></canvas>
</div>

The simulation engine will control when will we leave this screen. For now, please don't mind the awful colors and just press this button to finish the workflow:
<br>

<form action="debrief.html">
<script language="JavaScript">
gid = getValue("gid");
document.write('<input type="hidden" name="gid" value=' + gid + ' />');
</script>
<button type="submit">End Simulation</button>
</form>
</body>
</html>
